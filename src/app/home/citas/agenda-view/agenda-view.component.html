<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      
      <!-- Título principal del módulo (RQF01) -->
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-header bg-info text-white">
          <h2 class="h4 mb-0 text-center">Consulta de Agenda (Veterinario/Recepcionista)</h2>
        </div>
        <div class="card-body">
          <p class="text-muted text-center mb-4">
            RQF01 - Permite consultar citas programadas y gestionar reprogramaciones/cancelaciones.
          </p>

          <!-- RQF01 - Filtros de Consulta -->
          <div class="row g-3 mb-4 p-3 border rounded-3 bg-light">
            
            <div class="col-md-6">
              <label for="veterinario-select" class="form-label fw-bold">Veterinario</label>
              <!-- RQF01 - Filtro por Veterinario: El Veterinario puede consultar su agenda -->
              <select id="veterinario-select" class="form-select" 
                      [(ngModel)]="veterinarioSeleccionadoId" 
                      (change)="cargarCitas()">
                <option *ngFor="let vet of veterinarios" [value]="vet.id">
                  {{ vet.nombre }}
                </option>
              </select>
            </div>

            <div class="col-md-6">
              <label for="fecha-input" class="form-label fw-bold">Fecha de Consulta</label>
              <!-- RQF01 - Filtro por Fecha: Agenda diaria -->
              <input type="date" id="fecha-input" class="form-control" 
                     [(ngModel)]="fechaSeleccionada" 
                     (change)="cargarCitas()">
            </div>
            
          </div>

          <!-- RQF01 - SALIDA ESPERADA: Listado de Citas Filtradas -->
          <h3 class="h5 mb-3">Citas para el {{ fechaSeleccionada }}</h3>

          <!-- Mensaje cuando no hay citas -->
          <div *ngIf="citasAgenda.length === 0" class="alert alert-warning text-center">
            No hay citas programadas para el veterinario seleccionado en esta fecha.
          </div>

          <!-- LISTA DE CITAS (RQF01) -->
          <div class="list-group">
            
            <div *ngFor="let cita of citasAgenda" class="list-group-item list-group-item-action mb-3 shadow-sm border-start border-5 border-info">
              
              <div class="row align-items-center">
                
                <!-- Columna de Hora y Veterinario -->
                <div class="col-md-3">
                  <p class="mb-1 fw-bold text-info fs-5">
                    <i class="bi bi-clock-fill me-2"></i>{{ cita.hora }} HRS
                  </p>
                  <small class="text-muted">
                    Vet: {{ veterinarios | filtradoPorId: cita.veterinarioId }}
                  </small>
                </div>

                <!-- Columna de Detalles de la Cita (Uso de Pipes) -->
                <div class="col-md-6">
                  <p class="mb-1">
                    <strong class="text-primary">Mascota:</strong> 
                    {{ mascotas | filtradoPorId: cita.mascotaId }}
                  </p>
                  <p class="mb-1">
                    <strong class="text-success">Cliente:</strong> 
                    {{ clientes | filtradoPorId: cita.clienteId }}
                  </p>
                  <p class="mb-0 text-truncate">
                    <strong class="text-secondary">Motivo:</strong> {{ cita.motivo }}
                  </p>
                </div>

                <!-- Columna de Acciones (RQF01: Modificar y Cancelar) -->
                <div class="col-md-3 text-end">
                  <!-- NOTA: En un desarrollo real, estos abrirían un modal de confirmación o un formulario de edición. -->
                  <button (click)="gestionarCita(cita, 'reprogramar')" class="btn btn-sm btn-outline-primary me-2 mb-1">
                    Reprogramar
                  </button>
                  <button (click)="gestionarCita(cita, 'cancelar')" class="btn btn-sm btn-outline-danger mb-1">
                    Cancelar
                  </button>
                </div>
                
              </div>
            </div>
            
          </div>
          <!-- Fin de LISTA DE CITAS -->

        </div>
      </div>
    </div>
  </div>
</div>
