<div class="row w-100 h-100 mt-4">

  <div class="col-12">
    <div class="container-fluid mt-4">

      <div class="card shadow rounded-4 mb-4">
        <div class="card-body">

          <div class="d-flex align-items-center justify-content-between mb-3">
            <h1 class="titulo-principal m-0">Expedientes Médicos</h1>
          </div>

          <button class="btn btn-light w-100 d-flex align-items-center gap-2 mb-3"
                  (click)="toggleFiltros()">
            <i class="bi bi-funnel"></i>
            <span class="fw-semibold">Filtros de búsqueda</span>
            <i class="bi ms-auto bi-chevron-down chevron"
               [class.rotate-180]="filtrosVisible"></i>
          </button>

          <div class="collapse-animated" [class.show]="filtrosVisible">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label">Número de expediente</label>
                <input class="form-control"
                       placeholder="Buscar por número"
                       [(ngModel)]="filtros.numero_expediente"
                       (input)="aplicarFiltros()">
              </div>

              <div class="col-md-4">
                <label class="form-label">Paciente</label>
                <input class="form-control"
                       placeholder="Buscar paciente"
                       [(ngModel)]="filtros.paciente"
                       (input)="aplicarFiltros()">
              </div>

              <div class="col-md-4">
                <label class="form-label">Estado</label>
                <select class="form-select"
                        [(ngModel)]="filtros.estado"
                        (change)="aplicarFiltros()">
                  <option value="">Todos</option>
                  <option value="Activo">Activo</option>
                  <option value="Inactivo">Inactivo</option>
                </select>
              </div>

            </div>

          </div>

        </div>
      </div>

      <div class="card shadow rounded-4">
        <div class="card-body">

          <div class="table-responsive rounded-2">

            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
              <tr>
                <th>Número</th>
                <th>Paciente</th>
                <th>Cliente</th>
                <th>Estado</th>
                <th>Fecha apertura</th>
                <th class="text-center">Acciones</th>
              </tr>
              </thead>

              <tbody>

                <tr *ngFor="let exp of displayedExpedientes">
                  <td class="fw-semibold">{{ exp.numero_expediente }}</td>
                  <td>{{ exp.paciente_nombre }}</td>
                  <td>{{ exp.cliente_nombre }}</td>
                  <td>
                    <span class="badge bg-success" *ngIf="exp.estado === 'Activo'">Activo</span>
                    <span class="badge bg-secondary" *ngIf="exp.estado !== 'Activo'">{{ exp.estado }}</span>
                  </td>
                  <td>{{ exp.fecha_apertura | date }}</td>

                  <td class="text-center">

                    <button class="btn-icon btn-edit me-2"
                            matTooltip="Editar"
                            (click)="editarExpediente(exp)">
                      <i class="ri-edit-2-line"></i>
                    </button>

                    <button class="btn-icon btn-view"
                            matTooltip="Ver Detalles"
                            (click)="verDetalle(exp)">
                      <i class="ri-eye-line"></i>
                    </button>
                  </td>

                </tr>

                <tr *ngIf="expedientesFiltrados.length === 0">
                  <td colspan="100%" class="text-center text-muted">
                    No hay expedientes registrados
                  </td>
                </tr>

              </tbody>
            </table>

          </div>

          <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 mt-3">

            <div class="d-flex align-items-center gap-2">
              <label class="form-label m-0">Filas por página</label>
              <select class="form-select form-select-sm w-auto"
                      [(ngModel)]="pageSize"
                      (change)="goToPage(1)">
                <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
              </select>
            </div>

            <div class="d-flex align-items-center gap-3 ms-md-auto">

              <div class="text-muted small">
                Mostrando {{ rangeStart }}–{{ rangeEnd }} de {{ totalItems }}
              </div>

              <nav aria-label="Paginación expedientes">
                <ul class="pagination pagination-sm mb-0">

                  <li class="page-item" [class.disabled]="page === 1">
                    <button class="page-link" (click)="goToPage(1)">«</button>
                  </li>
                  <li class="page-item" [class.disabled]="page === 1">
                    <button class="page-link" (click)="prevPage()">‹</button>
                  </li>

                  <li class="page-item"
                      *ngFor="let p of visiblePages"
                      [class.active]="p === page">
                    <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                  </li>

                  <li class="page-item"
                      [class.disabled]="page === totalPages">
                    <button class="page-link" (click)="nextPage()">›</button>
                  </li>
                  <li class="page-item"
                      [class.disabled]="page === totalPages">
                    <button class="page-link" (click)="goToPage(totalPages)">»</button>
                  </li>

                </ul>
              </nav>

            </div>

          </div>

        </div>
      </div>

    </div>
  </div>

</div>
