<div class="row w-100 h-100 mt-5">
  @if (!openForm && !mostrarFormLote && !mostrarDetalle) {
<div class="col-12">
  <div class="container-fluid mt-4">

    <div class="card shadow rounded-4 mb-4">
      <div class="card-body">

        <div class="d-flex align-items-center justify-content-between mb-3">
          <h1 class="titulo-principal m-0">Inventario de Productos</h1>
          <button class="btn btn-primary-si" (click)="abrirForm()">
            <i class="bi bi-plus-circle me-1"></i> Registrar Producto
          </button>
        </div>

        <button class="btn btn-light w-100 d-flex align-items-center gap-2 mb-3"
                (click)="toggleFiltros()">
          <i class="bi bi-funnel"></i>
          <span class="fw-semibold">Filtros de Búsqueda</span>
          <i class="bi ms-auto bi-chevron-down chevron"
            [class.rotate-180]="filtrosVisible"></i>
        </button>

        <div class="collapse-animated" [class.show]="filtrosVisible">
          <div class="row g-3">
            <div class="col-md-4 col-lg-3">
              <label class="form-label">Nombre</label>
              <input class="form-control" placeholder="Buscar por nombre"
                    [(ngModel)]="filtros.nombre" (input)="aplicarFiltros()">
            </div>

            <div class="col-md-4 col-lg-3">
              <label class="form-label">Categoría</label>
              <select class="form-select" [(ngModel)]="filtros.categoria" (change)="aplicarFiltros()">
                <option value="">Todas</option>
                <option *ngFor="let cat of categorias" [value]="cat">{{cat}}</option>
              </select>
            </div>

            <div class="col-md-4 col-lg-3">
              <label class="form-label">Proveedor</label>
              <select class="form-select" [(ngModel)]="filtros.proveedor" (change)="aplicarFiltros()">
                <option value="">Todos</option>
                <option *ngFor="let prov of proveedores" [value]="prov">{{prov}}</option>
              </select>
            </div>

            <div class="col-md-4 col-lg-3 d-flex align-items-end">
              <button class="btn btn-outline-secondary w-100" (click)="limpiarFiltros()">
                <i class="bi bi-x-circle me-1"></i> Limpiar
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="card shadow rounded-4">
      <div class="card-body">
        <div class="table-responsive rounded-2">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>PRODUCTO</th>
                <th>DESCRIPCIÓN</th>
                <th>PRECIO</th>
                <th>UNIDAD</th>
                <th class="text-center">ACCIONES</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let producto of displayedProductos">
                <td>{{ producto.id }}</td>
                <td class="fw-semibold">{{ producto.nombre }}</td>
                <td>{{ producto.descripcion }}</td>
                <td><strong>${{ producto.precio_venta }}</strong></td>
                <td>{{ producto.unidad_medida }}</td>
                <td class="text-center">
                  <a
                    aria-label="Editar"
                    class="btn btn-icon btn-sm btn-warning-light btn-wave me-2"
                    matTooltip="Editar"
                    (click)="editarProducto(producto)">
                    <i class="ri-edit-2-fill"></i>
                  </a>
                  <a
                    aria-label="Eliminar"
                    class="btn btn-icon btn-sm btn-danger-light btn-wave me-2"
                    matTooltip="Eliminar"
                    (click)="eliminarProducto(producto)">
                    <i class="ri-delete-bin-6-line"></i>
                  </a>

                  <a
                    aria-label="Ver Detalles"
                    class="btn btn-icon btn-sm btn-warning-light btn-wave me-2"
                    matTooltip="Ver Detalles"
                    (click)="verDetalle(producto)">
                    <i class="ri-eye-line"></i>
                  </a>
                </td>

              </tr>

              <tr *ngIf="productosFiltrados.length === 0">
                <td colspan="100%" class="text-center text-muted">
                  No hay productos registrados
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 mt-3">
          <div class="d-flex align-items-center gap-2">
            <label class="form-label m-0">Filas por página</label>
            <select class="form-select form-select-sm w-auto" [(ngModel)]="pageSize" (change)="goToPage(1)">
              <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
            </select>
          </div>

          <div class="d-flex align-items-center gap-3 ms-md-auto">
            <div class="text-muted small">
              Mostrando {{ rangeStart }}–{{ rangeEnd }} de {{ totalItems }}
            </div>
            <nav aria-label="Paginación inventario">
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="page === 1">
                  <button class="page-link" (click)="goToPage(1)">«</button>
                </li>
                <li class="page-item" [class.disabled]="page === 1">
                  <button class="page-link" (click)="prevPage()">‹</button>
                </li>

                <li class="page-item" *ngFor="let p of visiblePages" [class.active]="p === page">
                  <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                </li>

                <li class="page-item" [class.disabled]="page === totalPages || totalPages === 0">
                  <button class="page-link" (click)="nextPage()">›</button>
                </li>
                <li class="page-item" [class.disabled]="page === totalPages || totalPages === 0">
                  <button class="page-link" (click)="goToPage(totalPages)">»</button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

  }@else {
    <div class="col-8 h-100" style="overflow-y: auto;">
<div class="col-12">
  <div class="container-fluid mt-4">

    <div class="card shadow rounded-4 mb-4">
      <div class="card-body">

        <div class="d-flex align-items-center justify-content-between mb-3">
          <h1 class="titulo-principal m-0">Inventario de Productos</h1>
          <button class="btn btn-primary-si" (click)="abrirForm()">
            <i class="bi bi-plus-circle me-1"></i> Registrar Producto
          </button>
        </div>

        <button class="btn btn-light w-100 d-flex align-items-center gap-2 mb-3"
                (click)="toggleFiltros()">
          <i class="bi bi-funnel"></i>
          <span class="fw-semibold">Filtros de Búsqueda</span>
          <i class="bi ms-auto bi-chevron-down chevron"
            [class.rotate-180]="filtrosVisible"></i>
        </button>

        <div class="collapse-animated" [class.show]="filtrosVisible">
          <div class="row g-3">
            <div class="col-md-4 col-lg-3">
              <label class="form-label">Nombre</label>
              <input class="form-control" placeholder="Buscar por nombre"
                    [(ngModel)]="filtros.nombre" (input)="aplicarFiltros()">
            </div>

            <div class="col-md-4 col-lg-3">
              <label class="form-label">Categoría</label>
              <select class="form-select" [(ngModel)]="filtros.categoria" (change)="aplicarFiltros()">
                <option value="">Todas</option>
                <option *ngFor="let cat of categorias" [value]="cat">{{cat}}</option>
              </select>
            </div>

            <div class="col-md-4 col-lg-3">
              <label class="form-label">Proveedor</label>
              <select class="form-select" [(ngModel)]="filtros.proveedor" (change)="aplicarFiltros()">
                <option value="">Todos</option>
                <option *ngFor="let prov of proveedores" [value]="prov">{{prov}}</option>
              </select>
            </div>

            <div class="col-md-4 col-lg-3 d-flex align-items-end">
              <button class="btn btn-outline-secondary w-100" (click)="limpiarFiltros()">
                <i class="bi bi-x-circle me-1"></i> Limpiar
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="card shadow rounded-4">
      <div class="card-body">
        <div class="table-responsive rounded-2">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>PRODUCTO</th>
                <th>DESCRIPCIÓN</th>
                <th>PRECIO</th>
                <th>UNIDAD</th>
                <th class="text-center">ACCIONES</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let producto of displayedProductos">
                <td>{{ producto.id }}</td>
                <td class="fw-semibold">{{ producto.nombre }}</td>
                <td>{{ producto.descripcion }}</td>
                <td><strong>${{ producto.precio_venta }}</strong></td>
                <td>{{ producto.unidad_medida }}</td>
                <td class="text-center">

                  <a
                    aria-label="Editar" class="btn btn-icon btn-sm btn-warning-light btn-wave me-2" matTooltip="Editar"
                    (click)="editarProducto(producto)">
                    <i class="ri-edit-2-fill"></i>
                  </a>
                  <a
                    aria-label="Eliminar"
                    class="btn btn-icon btn-sm btn-danger-light btn-wave"
                    matTooltip="Eliminar"
                    (click)="eliminarProducto(producto)">
                    <i class="ri-delete-bin-6-line"></i>
                  </a>
                  <a
                    aria-label="Ver Detalles " class="btn btn-icon btn-sm btn-warning-light btn-wave me-2" matTooltip="Editar"
                    (click)="editarProducto(producto)">
                    <i class="ri-eye-line"></i>
                  </a>

                </td>
              </tr>

              <tr *ngIf="productosFiltrados.length === 0">
                <td colspan="100%" class="text-center py-5 text-muted">
                  <i class="bi bi-inbox display-6 d-block mb-2"></i>
                  No hay productos registrados
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 mt-3">
          <div class="d-flex align-items-center gap-2">
            <label class="form-label m-0">Filas por página</label>
            <select class="form-select form-select-sm w-auto" [(ngModel)]="pageSize" (change)="goToPage(1)">
              <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
            </select>
          </div>

          <div class="d-flex align-items-center gap-3 ms-md-auto">
            <div class="text-muted small">
              Mostrando {{ rangeStart }}–{{ rangeEnd }} de {{ totalItems }}
            </div>
            <nav aria-label="Paginación inventario">
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="page === 1">
                  <button class="page-link" (click)="goToPage(1)">«</button>
                </li>
                <li class="page-item" [class.disabled]="page === 1">
                  <button class="page-link" (click)="prevPage()">‹</button>
                </li>

                <li class="page-item" *ngFor="let p of visiblePages" [class.active]="p === page">
                  <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                </li>

                <li class="page-item" [class.disabled]="page === totalPages || totalPages === 0">
                  <button class="page-link" (click)="nextPage()">›</button>
                </li>
                <li class="page-item" [class.disabled]="page === totalPages || totalPages === 0">
                  <button class="page-link" (click)="goToPage(totalPages)">»</button>
                </li>
              </ul>
            </nav>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
    </div>

  <div class="col-4 h-100 d-flex flex-column" style="border-left: 1px solid #dee2e6; overflow-y: auto;">
    <app-inventario-form
      *ngIf="openForm"
      [producto]="selectedProducto"
      (onGuardar)="handleGuardar($event)"
      (closeEvent)="closeForm()">
    </app-inventario-form>

    <app-inventario-lote-form
      *ngIf="mostrarFormLote"
      [producto]="productoSeleccionado"
      (closeEvent)="cerrarFormLote()">
    </app-inventario-lote-form>

    <app-inventario-detalle
      *ngIf="mostrarDetalle"
      [detalle]="detalleProducto"
      (close)="cerrarDetalle()">
    </app-inventario-detalle>
  </div>
  }
</div>
