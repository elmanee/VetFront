<div class="row w-100 h-100 mt-4">
  <div class="col-12">
    <div class="container-fluid mt-4">

      <div class="card shadow rounded-4 mb-4">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h1 class="titulo-principal m-0">Movimientos de Inventario</h1>
          </div>

          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Tipo de Movimiento</label>
              <select class="form-select" [(ngModel)]="filtroTipo" (change)="aplicarFiltro()">
                <option value="">Todos</option>
                <option value="entrada">Entrada</option>
                <option value="salida">Salida</option>
                <option value="ajuste">Ajuste</option>
                <option value="eliminacion">Eliminación</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Buscar por Producto</label>
              <input
                type="text"
                class="form-control"
                placeholder="Nombre del producto..."
                [(ngModel)]="filtroProducto"
                (input)="aplicarFiltro()"
              />
            </div>

            <div class="col-md-3">
              <label class="form-label">Fecha (desde)</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="filtroInicio"
                (change)="aplicarFiltro()"
              />
            </div>

            <div class="col-md-3">
              <label class="form-label">Fecha (hasta)</label>
              <input
                type="date"
                class="form-control"
                [(ngModel)]="filtroFin"
                (change)="aplicarFiltro()"
              />
            </div>
          </div>

          <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-outline-clean" (click)="limpiarFiltros()">
              <i class="ri-refresh-line me-1"></i> Limpiar filtros
            </button>
          </div>
        </div>
      </div>

      <div class="card shadow rounded-4">
        <div class="card-body">
          <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-outline-success me-2" (click)="exportarExcel()">
              <i class="ri-file-excel-2-line me-1"></i> Exportar Excel
            </button>

            <button class="btn btn-outline-danger" (click)="exportarPDF()">
              <i class="ri-file-pdf-2-line me-1"></i> Exportar PDF
            </button>
          </div>

          <div class="table-responsive rounded-2">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Tipo</th>
                  <th>Producto</th>
                  <th>Lote</th>
                  <th>Cantidad</th>
                  <th>Motivo</th>
                  <th>Usuario</th>
                  <th>Fecha</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let mov of displayedMovimientos">
                  <td>
                    <span class="badge"
                          [ngClass]="{
                            'bg-success': mov.tipo === 'entrada',
                            'bg-danger': mov.tipo === 'salida',
                            'bg-warning text-dark': mov.tipo === 'ajuste',
                            'bg-secondary': mov.tipo === 'eliminacion'
                          }">
                      {{ mov.tipo | titlecase }}
                    </span>
                  </td>
                  <td>{{ mov.producto_nombre }}</td>
                  <td>{{ mov.num_lote }}</td>
                  <td>{{ mov.cantidad }}</td>
                  <td>{{ mov.motivo }}</td>
                  <td>{{ mov.usuario_nombre || '—' }}</td>
                  <td>{{ mov.fecha_movimiento | date:'dd/MM/yyyy HH:mm' }}</td>
                </tr>

                <tr *ngIf="displayedMovimientos.length === 0">
                  <td colspan="100%" class="text-center text-muted py-3">
                    <i class="ri-inbox-2-line fs-4 d-block mb-2"></i>
                    No se encontraron movimientos registrados.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div
              class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3 mt-3"
            >
              <div class="d-flex align-items-center gap-2">
                <label class="form-label m-0">Filas por página</label>
                <select
                  class="form-select form-select-sm w-auto"
                  [(ngModel)]="pageSize"
                  (change)="goToPage(1)"
                >
                  <option *ngFor="let s of pageSizeOptions" [value]="s">
                    {{ s }}
                  </option>
                </select>
              </div>
              <div class="d-flex align-items-center gap-3 ms-md-auto">
                <div class="text-muted small">
                  Mostrando {{ rangeStart }}–{{ rangeEnd }} de {{ totalItems }}
                </div>
                <nav aria-label="Paginación inventario">
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="page === 1">
                      <button class="page-link" (click)="goToPage(1)">«</button>
                    </li>
                    <li class="page-item" [class.disabled]="page === 1">
                      <button class="page-link" (click)="prevPage()">‹</button>
                    </li>
                    <li
                      class="page-item"
                      *ngFor="let p of visiblePages"
                      [class.active]="p === page"
                    >
                      <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                    </li>
                    <li
                      class="page-item"
                      [class.disabled]="page === totalPages || totalPages === 0"
                    >
                      <button class="page-link" (click)="nextPage()">›</button>
                    </li>
                    <li
                      class="page-item"
                      [class.disabled]="page === totalPages || totalPages === 0"
                    >
                      <button class="page-link" (click)="goToPage(totalPages)">
                        »
                      </button>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
        </div>
      </div>

    </div>
  </div>
</div>
