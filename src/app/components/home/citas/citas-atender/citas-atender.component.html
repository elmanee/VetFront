<div class="container-fluid min-vh-100 bg-light py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-11">
      
      <!-- Encabezado -->
      <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-dark mb-3">
          <i class="bi bi-clipboard2-pulse me-2"></i>
          Citas por Atender
        </h1>
        <p class="lead text-muted">
          Listado de citas confirmadas listas para registrar consulta médica
        </p>
      </div>

      <!-- Mensajes -->
      <div *ngIf="mensaje" class="alert alert-dismissible fade show mb-4" 
           [ngClass]="{
             'alert-success': mensajeClase === 'success',
             'alert-danger': mensajeClase === 'error',
             'alert-info': mensajeClase === 'info'
           }"
           role="alert">
        <div class="d-flex align-items-center">
          <i class="bi me-2" 
             [ngClass]="{
               'bi-check-circle-fill': mensajeClase === 'success',
               'bi-exclamation-triangle-fill': mensajeClase === 'error',
               'bi-info-circle-fill': mensajeClase === 'info'
             }"></i>
          <span>{{ mensaje }}</span>
        </div>
        <button type="button" class="btn-close" (click)="mensaje = ''" aria-label="Close"></button>
      </div>

      <!-- Panel de filtros -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-3">
            <i class="bi bi-funnel me-2"></i>
            Filtros de Búsqueda
          </h5>
          
          <div class="row g-3">
            <!-- Filtro por veterinario -->
            <div class="col-md-3">
              <label for="veterinarioSelect" class="form-label fw-semibold">
                <i class="bi bi-person-badge me-1"></i>
                Veterinario
              </label>
              <select 
                id="veterinarioSelect" 
                class="form-select" 
                [(ngModel)]="veterinarioSeleccionado"
                (change)="aplicarFiltros()">
                <option *ngFor="let vet of veterinarios" [value]="vet.id">
                  {{ vet.nombre }}
                </option>
              </select>
            </div>
            
            <!-- Filtro por fecha -->
            <div class="col-md-3">
              <label for="fechaSelect" class="form-label fw-semibold">
                <i class="bi bi-calendar-date me-1"></i>
                Fecha
              </label>
              <input 
                type="date" 
                id="fechaSelect"
                class="form-control" 
                [(ngModel)]="fechaSeleccionada"
                (change)="aplicarFiltros()">
            </div>
            
            <!-- Búsqueda por texto -->
            <div class="col-md-4">
              <label for="busquedaTexto" class="form-label fw-semibold">
                <i class="bi bi-search me-1"></i>
                Buscar
              </label>
              <input 
                type="text" 
                id="busquedaTexto"
                class="form-control" 
                placeholder="ID de cita, motivo..."
                [(ngModel)]="busquedaTexto"
                (input)="aplicarFiltros()">
            </div>
            
            <!-- Botones -->
            <div class="col-md-2 d-flex align-items-end">
              <button 
                class="btn btn-outline-secondary w-100"
                (click)="limpiarFiltros()">
                <i class="bi bi-x-circle me-1"></i>
                Limpiar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Estadísticas -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="card border-0 shadow-sm bg-primary text-white">
            <div class="card-body text-center">
              <h3 class="display-6 fw-bold mb-0">{{ citasConfirmadas.length }}</h3>
              <p class="mb-0">Total Confirmadas</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm bg-success text-white">
            <div class="card-body text-center">
              <h3 class="display-6 fw-bold mb-0">{{ contarCitasHoy() }}</h3>
              <p class="mb-0">Para Hoy</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm bg-warning text-dark">
            <div class="card-body text-center">
              <h3 class="display-6 fw-bold mb-0">{{ citasFiltradas.length }}</h3>
              <p class="mb-0">Filtradas</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="cargando" class="text-center py-5">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="text-muted mt-3">Cargando citas...</p>
      </div>

      <!-- Lista de citas -->
      <div class="row mt-4" *ngIf="!cargando">
        <div class="col-12 mb-3">
          <h3 class="h5 fw-bold">
            Citas Confirmadas
            <span class="badge bg-primary">{{ citasFiltradas.length }}</span>
          </h3>
        </div>
        
        <!-- Mensaje si no hay citas -->
        <div *ngIf="citasFiltradas.length === 0" class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-5">
              <i class="bi bi-calendar-x display-1 text-muted"></i>
              <h4 class="mt-3 text-muted">No hay citas confirmadas</h4>
              <p class="text-muted">
                No se encontraron citas confirmadas con los filtros seleccionados.
              </p>
            </div>
          </div>
        </div>

        <!-- Cards de citas -->
        <div *ngFor="let cita of citasFiltradas" class="col-lg-6 col-xl-4 mb-4">
          <div class="card h-100 border-0 shadow-sm hover-card"
               [class.border-warning]="esProxima(cita.fecha_cita, cita.hora_cita)"
               [class.border-success]="esHoy(cita.fecha_cita)">
            <div class="card-body p-4">
              
              <!-- Header -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <span class="badge bg-success mb-2">
                    <i class="bi bi-check-circle me-1"></i>
                    Confirmada
                  </span>
                  <span *ngIf="esHoy(cita.fecha_cita)" class="badge bg-info ms-1">
                    <i class="bi bi-calendar-event me-1"></i>
                    HOY
                  </span>
                  <span *ngIf="esProxima(cita.fecha_cita, cita.hora_cita)" class="badge bg-warning text-dark ms-1">
                    <i class="bi bi-clock me-1"></i>
                    PRÓXIMA
                  </span>
                </div>
                <div class="text-end">
                  <h4 class="mb-0 fw-bold text-primary">{{ cita.hora_cita }}</h4>
                  <small class="text-muted">Cita #{{ cita.id_cita }}</small>
                </div>
              </div>

              <!-- Información de la cita -->
              <div class="mb-3">
                <h5 class="fw-bold text-dark mb-2">{{ cita.motivo }}</h5>
                
                <div class="info-item mb-2">
                  <i class="bi bi-calendar3 text-muted me-2"></i>
                  <span class="small">{{ formatearFecha(cita.fecha_cita) }}</span>
                </div>
                
                <div class="info-item mb-2">
                  <i class="bi bi-person-fill text-muted me-2"></i>
                  <span class="small">Cliente ID: {{ cita.cliente_id }}</span>
                </div>
                
                <div class="info-item" *ngIf="cita.mascota_id">
                  <i class="bi bi-heart-fill text-danger me-2"></i>
                  <span class="small">Mascota ID: {{ cita.mascota_id }}</span>
                </div>
                
                <div class="info-item" *ngIf="!cita.mascota_id">
                  <i class="bi bi-plus-circle text-warning me-2"></i>
                  <span class="small text-warning">Mascota Nueva</span>
                </div>
              </div>

              <!-- Botón de acción -->
              <div class="d-grid">
                <button 
                  class="btn btn-primary fw-semibold"
                  (click)="atenderCita(cita)">
                  <i class="bi bi-clipboard2-pulse me-2"></i>
                  Atender Cita
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
.hover-card {
  transition: transform 0.2s, box-shadow 0.2s;
}

.hover-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.info-item {
  display: flex;
  align-items: center;
}
</style>